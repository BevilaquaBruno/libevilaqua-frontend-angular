<mat-tab-group #loginTabs [selectedIndex]="selectedIndex()">
  <mat-tab>
    <ng-template hidden mat-tab-label>tab-login</ng-template>
    <div class="row">
      <div class="col"></div>
      <div class="col">
        <form [formGroup]="form" novalidate (ngSubmit)="onSubmit()">
          <mat-card class="login-card">
            <mat-card-header>
              <mat-card-title>
                <b style="font-size: xx-large;">{{APP_NAME}} - Login</b>
              </mat-card-title>
              <mat-card-subtitle>
                informe seu e-mail e senha para acessar sua biblioteca.
                @if ('' != generalLoginError()) {
                <div class="text-center">
                  <span class="red-text-button">{{generalLoginError()}}</span>
                </div>
                }
              </mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <mat-form-field floatLabel="auto" class="full-width">
                <mat-label>E-mail</mat-label>
                <input matInput placeholder="john@doe.com" type="email" formControlName="email" />
                @if (form.get('email')?.hasError('required') && form.get('email')?.touched) {
                <mat-error>
                  O e-mail é obrigatório.
                </mat-error>
                }

                @if (form.get('email')?.hasError('email') && form.get('email')?.dirty) {
                <mat-error>
                  Informe um e-mail válido.
                </mat-error>
                }
              </mat-form-field>
              <mat-form-field floatLabel="auto" class="full-width">
                <mat-label>Senha</mat-label>
                <input matInput placeholder="********" type="password" formControlName="password" />
                @if(form.get('password')?.hasError('required') && form.get('password')?.touched){
                <mat-error>
                  A senha é obrigatória.
                </mat-error>
                }

                @if(form.get('password')?.hasError('minlength') && form.get('password')?.dirty){
                <mat-error>
                  A senha deve ter pelo menos 6 caracteres.
                </mat-error>
                }
              </mat-form-field>
            </mat-card-content>
            <mat-card-actions>
              <button class="rect-button" matButton="filled" type="submit">Entrar</button>
              <button class="rect-button red-text-button" matButton="text" type="button" (click)="resetPassword()">
                Esqueci a senha
              </button>
              <app-loading [loading]="isLoginLoading"></app-loading>
            </mat-card-actions>
          </mat-card>
          <button class="rect-button full-width" matButton="text" type="button" (click)="newLibrary()">
            Cadastrar nova biblioteca
          </button>
        </form>
      </div>
      <div class="col"></div>
    </div>
  </mat-tab>
  <mat-tab>
    <ng-template hidden mat-tab-label>tab-select-library</ng-template>
    <div class="row">
      <div class="col"></div>
      <div class="col">
        <mat-card class="login-card">
          <mat-card-header style="max-width: 500px;">
            <mat-card-title>
              <button matIconButton aria-label="Voltar para o login" (click)="goBackToLogin()">
                <mat-icon>arrow_back</mat-icon>
              </button>
              <b style="font-size: xx-large;">{{APP_NAME}}</b>
            </mat-card-title>
            <mat-card-subtitle>
              Selecione a biblioteca que deseja acessar.
              @if ('' != generalLibraryError()) {
              <div class="text-center">
                <span class="red-text-button">{{generalLibraryError()}}</span>
              </div>
              }
            </mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            @if (filteredLibraries().length > 0) {
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Selecione a biblioteca</mat-label>
              <input type="text" matInput [formControl]="libraryCtrl" [matAutocomplete]="auto"
                (input)="searchText.set($event.target.value)">

              <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayLibrary"
                (optionSelected)="selectLibrary($event)">
                @for (lib of filteredLibraries(); track lib.id) {
                <mat-option [value]="lib">
                  {{ lib.description }}
                </mat-option>
                }
              </mat-autocomplete>
            </mat-form-field>
            } @else {
            <span class="red-text-button">Você possui uma conta, porém não existem bibliotecas vinculadas.</span>
            <br />
            <span class="green-text-button clickable" (click)="newLibrary()">Clique aqui</span>
            <span class="red-text-button">&nbsp;para cadastrar uma nova biblioteca</span>
            }
          </mat-card-content>
          <mat-card-actions>
            <app-loading [loading]="isSelectLibraryLoading"></app-loading>
          </mat-card-actions>
        </mat-card>
      </div>
      <div class="col"></div>
    </div>
  </mat-tab>
</mat-tab-group>
